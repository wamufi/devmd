---
title: 간단한 월 달력
date:  2025-07-18
time:  11:15:04
tags:
  - swift
  - swiftui
---
```swift
import SwiftUI

struct MonthlyCalendarView: View {
    
    @Environment(\.locale) private var locale
    
    @State private var selectedDate: Date = Date() // 선택한 날짜
    @State private var selectedMonth: Date = Date() // 선택한 달의 1일
    
    @State private var hasAppeared = false // 최초 1회만 실행되도록 조건 제어

    var date: Date
    private let calendar = Calendar.current
    
    var body: some View {
        NavigationStack {
            contentView()
                .onAppear {
                    if !hasAppeared {
                        hasAppeared = true
                        initDate()
                    }
                }
        }
    }
    
    /// 날짜 초기 설정
    private func initDate() {
        // rawStart에서 연/월만 남긴 매월 1일 계산
        let normalizedStart = calendar.date(from: calendar.dateComponents([.year, .month], from: date)) ?? date
        
        selectedMonth = normalizedStart // 페이지용
        selectedDate = date // 실제 선택일
    }
    
    func contentView() -> some View {
        VStack {
            HStack {
                Button {
                    changePage(by: -1)
                } label: {
                    Image(systemName: "chevron.left")
                }
                .disabled(selectedMonth.month <= 1)
                
                Spacer()
                
                Text(selectedDate.localizedMonthYear(locale))
                    .font(.headline)
                
                Spacer()
                
                Button {
                    changePage(by: +1)
                } label: {
                    Image(systemName: "chevron.right")
                }
                .disabled(selectedMonth.month >= 12)
            }
            .frame(maxWidth: .infinity)
            .padding(.horizontal, 16)
            .padding(.top, 16)
            
            TabView(selection: $selectedMonth) {
                ForEach(firstDaysOfMonths(in: selectedMonth.year), id: \.self) { pageDate in
                    MonthlyView(selectedDate: $selectedDate, year: pageDate.year, month: pageDate.month)
                        .tag(pageDate)
                }
            }
            .frame(height: 260)
            .tabViewStyle(PageTabViewStyle(indexDisplayMode: .never))
            .animation(.easeInOut, value: selectedMonth)
            .onChange(of: selectedMonth) { newPage in
                guard !selectedDate.isSameYearAndMonth(newPage) else { return } // 선택된 날짜가 현재 페이지의 날짜와 같은 연/월이면 리턴
                guard let firstOfMonth = calendar.date(from: DateComponents(year: newPage.year, month: newPage.month, day: 1)) else { return } // 그 달의 1일 계산
                selectedDate = firstOfMonth // 달이 바뀔 때마다 1일을 선택일로 변경
            }
            
            Divider()
            
            Text("\(selectedDate)")
        }
    }
    
    
    /// 이전/다음 버튼 액션: selectedMonth를 실제 배열 값으로 교체
    private func changePage(by offset: Int) {
        guard let candidate = Calendar.current.date(byAdding: .month, value: offset, to: selectedMonth) else { return }
        selectedMonth = candidate
    }
    
    /// 각 달의 첫번째 날 배열
    private func firstDaysOfMonths(in year: Int, calendar: Calendar = .current) -> [Date] {
        var dates: [Date] = []
        for month in 1...12 {
            var comps = DateComponents()
            comps.year  = year
            comps.month = month
            comps.day   = 1
            if let date = calendar.date(from: comps) {
                dates.append(date)
            }
        }
        return dates
    }
}


fileprivate struct MonthlyView: View {
    
    @Environment(\.locale) private var locale
    
    @Binding var selectedDate: Date
    
    let year: Int
    let month: Int
    
    private let calendar = Calendar.current
    private let weekdaySymbols = Calendar.current.shortStandaloneWeekdaySymbols
    
    private var days: [Date] {
        guard let startOfMonth = calendar.date(from: DateComponents(year: year, month: month, day: 1)),
              let range = calendar.range(of: .day, in: .month, for: startOfMonth) else { return [] }
        return range.compactMap { day in
            calendar.date(from: DateComponents(year: year, month: month, day: day))
        }
    }
    
    var body: some View {
        VStack(spacing: 12) {
            HStack(spacing: 4) { // 요일
                ForEach(weekdaySymbols, id: \.self) { wd in
                    Text(String(wd.prefix(1)))
                        .font(.body)
                        .foregroundStyle(Color(uiColor: UIColor.secondaryLabel))
                        .frame(maxWidth: .infinity)
                }
            }
            
            let gridItems = Array(repeating: GridItem(.flexible(), spacing: 4), count: 7)
            LazyVGrid(columns: gridItems, alignment: .leading, spacing: 4) {
                // 1일 앞 빈칸
                if let firstDate = days.first {
                    let firstWeekday = calendar.component(.weekday, from: firstDate)
                    ForEach(0..<firstWeekday-1, id: \.self) { _ in
                        Text("").frame(maxWidth: .infinity, minHeight: 24)
                    }
                }
                
                // 실제 날짜 cell
                ForEach(days, id: \.self) { date in
                    let day = calendar.component(.day, from: date)
                    Text("\(day)")
                        .font(.body)
                        .foregroundStyle(Color(uiColor: UIColor.label))
                        .frame(maxWidth: .infinity, minHeight: 24)
                        .padding(4)
                        .background(cellBackground(for: date))
                        .onTapGesture {
                            selectedDate = date
                        }
                }
            }
        }
        .padding()
    }
    
    @ViewBuilder
    private func cellBackground(for date: Date) -> some View {
        if calendar.isDateInToday(date) { // 오늘
            Circle().fill(Color.blue.opacity(0.3))
        } else if calendar.isDate(selectedDate, inSameDayAs: date) { // 선택한 날짜
            Circle().stroke(Color.accentColor, lineWidth: 2)
        } else {
            Color.clear
        }
    }
}

extension Date {
    var year: Int {
        Calendar.current.component(.year, from: self)
    }
    
    var month: Int {
        Calendar.current.component(.month, from: self)
    }
    
    var day: Int {
        Calendar.current.component(.day, from: self)
    }
    
    /// 로컬라이즈된 연월 이름
    func localizedMonthYear(_ locale: Locale) -> String {
        let calendar = Calendar.current
        let components = DateComponents(year: self.year, month: self.month, day: self.day)
        let date = calendar.date(from: components)!
        
        let template = "yMMMM"
        let format = DateFormatter.dateFormat(fromTemplate: template, options: 0, locale: locale)!
        
        let formatter = DateFormatter()
        formatter.locale = locale
        formatter.dateFormat = format
        
        return formatter.string(from: date)
    }
    
    /// 두 날짜가 같은 연도이면서 같은 월인지 확인
    func isSameYearAndMonth(_ date2: Date) -> Bool {
        let calendar = Calendar.current
        let components1 = calendar.dateComponents([.year, .month], from: self)
        let components2 = calendar.dateComponents([.year, .month], from: date2)
        
        return components1.year == components2.year && components1.month == components2.month
    }
}

```