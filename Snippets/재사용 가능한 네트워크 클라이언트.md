---
title: Alamofire
date:  2025-07-09
time:  10:56:20
tags:
  - swift
  - ios
---
Alamofire

```swift
actor ApiClient {
    
    var headers: HTTPHeaders = [
        "Content-Type": "application/json"
    ]
    
    /// 리퀘스트
    func request<E: Encodable, T: Decodable>(_ url: String, method: HTTPMethod = .post, parameters: E? = nil, of type: T.Type = T.self) async throws -> T {
        let encoder: ParameterEncoder = switch method {
        case .get:
            URLEncodedFormParameterEncoder.default
        default:
            JSONParameterEncoder.default
        }
        
        return try await withCheckedThrowingContinuation { continuation in
            AF.request(url, method: method, parameters: parameters, encoder: encoder, headers: headers).validate().responseDecodable(of: type) { response in
                debugPrint(response)
                switch response.result {
                case let .success(value):
                    continuation.resume(returning: value)
                case let .failure(error):
                    continuation.resume(throwing: error)
                }
            }
        }
    }
    
    /// 다운로드
    func download(from url: String, to destinationUrl: URL, method: HTTPMethod = .get, progressHandler: @escaping (Double) -> Void) async throws -> URL {
        let destination: DownloadRequest.Destination = { _, _ in
            return (destinationUrl, [.removePreviousFile, .createIntermediateDirectories])
        }
        
        return try await withCheckedThrowingContinuation { continuation in
            AF.download(url, method: method, headers: headers, to: destination).validate()
                .downloadProgress { progress in
                    progressHandler(progress.fractionCompleted)
                }
                .response { response in
                    debugPrint(response)
                    switch response.result {
                    case let .success(value):
                        if let filePath = value {
                            continuation.resume(returning: filePath)
                        }
                    case let .failure(error):
                        continuation.resume(throwing: error)
                    }
                }
        }
    }
    
    /// 서버 응답 여부 확인
    ​func isReachable(_ url: String) async throws -> Bool {
        let response = try await withCheckedThrowingContinuation { continuation in
            AF.request(url, method: .head).response { response in
                debugPrint(response)
                switch response.result {
                case .success:
                    continuation.resume(returning: response)
                case .failure(let error):
                    continuation.resume(throwing: error)
                }
            }
        }
        
        return response.response?.statusCode == 200
    }
}
```